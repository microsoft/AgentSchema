// Code generated by AgentSchema emitter; DO NOT EDIT.

package agentschema

import (
	"encoding/json"

	"gopkg.in/yaml.v3"
)

// PropertySchema represents Definition for the property schema of a model.
// This includes the properties and example records.

type PropertySchema struct {
	Examples   map[string]interface{} `json:"examples,omitempty" yaml:"examples,omitempty"`
	Strict     *bool                  `json:"strict,omitempty" yaml:"strict,omitempty"`
	Properties []interface{}          `json:"properties" yaml:"properties"`
}

// LoadPropertySchema creates a PropertySchema from a map[string]interface{}
func LoadPropertySchema(data interface{}, ctx *LoadContext) (PropertySchema, error) {
	result := PropertySchema{}

	// Load from map
	if m, ok := data.(map[string]interface{}); ok {
		if val, ok := m["examples"]; ok && val != nil {
			if m, ok := val.(map[string]interface{}); ok {
				result.Examples = m
			}
		}
		if val, ok := m["strict"]; ok && val != nil {
			v := val.(bool)
			result.Strict = &v
		}
		if val, ok := m["properties"]; ok && val != nil {
			if arr, ok := val.([]interface{}); ok {
				result.Properties = make([]interface{}, len(arr))
				for i, v := range arr {
					if item, ok := v.(map[string]interface{}); ok {
						loaded, _ := LoadProperty(item, ctx)
						// Polymorphic type - store as interface{}
						result.Properties[i] = loaded
					}
				}
			}
		}
	}

	return result, nil
}

// Save serializes PropertySchema to map[string]interface{}
func (obj *PropertySchema) Save(ctx *SaveContext) map[string]interface{} {
	result := make(map[string]interface{})
	if obj.Examples != nil {
		result["examples"] = obj.Examples
	}
	if obj.Strict != nil {
		result["strict"] = *obj.Strict
	}
	if obj.Properties != nil {
		arr := make([]interface{}, len(obj.Properties))
		for i, item := range obj.Properties {
			// Handle polymorphic type via type switch
			switch v := item.(type) {
			case interface {
				Save(*SaveContext) map[string]interface{}
			}:
				arr[i] = v.Save(ctx)
			default:
				arr[i] = item
			}
		}
		result["properties"] = arr
	}

	return result
}

// ToJSON serializes PropertySchema to JSON string
func (obj *PropertySchema) ToJSON() (string, error) {
	ctx := NewSaveContext()
	data := obj.Save(ctx)
	bytes, err := json.Marshal(data)
	if err != nil {
		return "", err
	}
	return string(bytes), nil
}

// ToYAML serializes PropertySchema to YAML string
func (obj *PropertySchema) ToYAML() (string, error) {
	ctx := NewSaveContext()
	data := obj.Save(ctx)
	bytes, err := yaml.Marshal(data)
	if err != nil {
		return "", err
	}
	return string(bytes), nil
}

// FromJSON creates PropertySchema from JSON string
func PropertySchemaFromJSON(jsonStr string) (PropertySchema, error) {
	var data map[string]interface{}
	if err := json.Unmarshal([]byte(jsonStr), &data); err != nil {
		return PropertySchema{}, err
	}
	ctx := NewLoadContext()
	return LoadPropertySchema(data, ctx)
}

// FromYAML creates PropertySchema from YAML string
func PropertySchemaFromYAML(yamlStr string) (PropertySchema, error) {
	var data map[string]interface{}
	if err := yaml.Unmarshal([]byte(yamlStr), &data); err != nil {
		return PropertySchema{}, err
	}
	ctx := NewLoadContext()
	return LoadPropertySchema(data, ctx)
}

// Copyright (c) Microsoft. All rights reserved.
// WARNING: This is an auto-generated file. DO NOT EDIT THIS FILE DIRECTLY.

package agentschema_test

import (
	"encoding/json"
	"strings"
	"testing"

	"github.com/microsoft/agentschema-go/agentschema"
)

func TestLoadContext_DefaultValues(t *testing.T) {
	ctx := agentschema.NewLoadContext()
	if ctx.PreProcess != nil {
		t.Error("Expected PreProcess to be nil by default")
	}
	if ctx.PostProcess != nil {
		t.Error("Expected PostProcess to be nil by default")
	}
}

func TestLoadContext_ProcessInput_NoCallback(t *testing.T) {
	ctx := agentschema.NewLoadContext()
	data := map[string]interface{}{"key": "value"}
	result := ctx.ProcessInput(data)
	if result["key"] != "value" {
		t.Errorf("Expected key to be 'value', got %v", result["key"])
	}
}

func TestLoadContext_ProcessInput_WithCallback(t *testing.T) {
	ctx := agentschema.NewLoadContext()
	ctx.PreProcess = func(data map[string]interface{}) map[string]interface{} {
		result := make(map[string]interface{})
		for k, v := range data {
			result[k] = v
		}
		result["added"] = true
		return result
	}
	data := map[string]interface{}{"key": "value"}
	result := ctx.ProcessInput(data)
	if result["added"] != true {
		t.Error("Expected 'added' field to be true")
	}
}

func TestLoadContext_ProcessOutput_NoCallback(t *testing.T) {
	ctx := agentschema.NewLoadContext()
	input := map[string]interface{}{"some": "result"}
	result := ctx.ProcessOutput(input)
	if result.(map[string]interface{})["some"] != "result" {
		t.Error("Expected result to be unchanged")
	}
}

func TestLoadContext_ProcessOutput_WithCallback(t *testing.T) {
	ctx := agentschema.NewLoadContext()
	ctx.PostProcess = func(result interface{}) interface{} {
		return map[string]interface{}{"wrapped": result}
	}
	input := map[string]interface{}{"key": "value"}
	result := ctx.ProcessOutput(input)
	wrapped := result.(map[string]interface{})
	if wrapped["wrapped"] == nil {
		t.Error("Expected result to be wrapped")
	}
}

func TestSaveContext_DefaultValues(t *testing.T) {
	ctx := agentschema.NewSaveContext()
	if ctx.PreSave != nil {
		t.Error("Expected PreSave to be nil by default")
	}
	if ctx.PostSave != nil {
		t.Error("Expected PostSave to be nil by default")
	}
	if ctx.CollectionFormat != "object" {
		t.Errorf("Expected CollectionFormat to be 'object', got %s", ctx.CollectionFormat)
	}
	if ctx.UseShorthand != true {
		t.Error("Expected UseShorthand to be true by default")
	}
}

func TestSaveContext_ProcessObject_NoCallback(t *testing.T) {
	ctx := agentschema.NewSaveContext()
	obj := map[string]interface{}{"key": "value"}
	result := ctx.ProcessObject(obj)
	if result.(map[string]interface{})["key"] != "value" {
		t.Error("Expected object to be unchanged")
	}
}

func TestSaveContext_ProcessObject_WithCallback(t *testing.T) {
	ctx := agentschema.NewSaveContext()
	ctx.PreSave = func(obj interface{}) interface{} {
		m := obj.(map[string]interface{})
		result := make(map[string]interface{})
		for k, v := range m {
			result[k] = v
		}
		result["timestamp"] = "2024-01-01"
		return result
	}
	obj := map[string]interface{}{"key": "value"}
	result := ctx.ProcessObject(obj)
	if result.(map[string]interface{})["timestamp"] != "2024-01-01" {
		t.Error("Expected timestamp to be added")
	}
}

func TestSaveContext_ProcessDict_NoCallback(t *testing.T) {
	ctx := agentschema.NewSaveContext()
	data := map[string]interface{}{"key": "value"}
	result := ctx.ProcessDict(data)
	if result["key"] != "value" {
		t.Error("Expected dict to be unchanged")
	}
}

func TestSaveContext_ProcessDict_WithCallback(t *testing.T) {
	ctx := agentschema.NewSaveContext()
	ctx.PostSave = func(data map[string]interface{}) map[string]interface{} {
		result := make(map[string]interface{})
		for k, v := range data {
			if !strings.HasPrefix(k, "_") {
				result[k] = v
			}
		}
		return result
	}
	data := map[string]interface{}{"key": "value", "_internal": "secret"}
	result := ctx.ProcessDict(data)
	if _, exists := result["_internal"]; exists {
		t.Error("Expected _internal to be removed")
	}
	if result["key"] != "value" {
		t.Error("Expected key to remain")
	}
}

func TestSaveContext_ToYAML(t *testing.T) {
	ctx := agentschema.NewSaveContext()
	data := map[string]interface{}{"name": "test"}
	result, err := ctx.ToYAML(data)
	if err != nil {
		t.Fatalf("ToYAML failed: %v", err)
	}
	if !strings.Contains(result, "name: test") {
		t.Errorf("Expected YAML to contain 'name: test', got: %s", result)
	}
}

func TestSaveContext_ToJSON(t *testing.T) {
	ctx := agentschema.NewSaveContext()
	data := map[string]interface{}{"name": "test"}
	result, err := ctx.ToJSON(data)
	if err != nil {
		t.Fatalf("ToJSON failed: %v", err)
	}
	var parsed map[string]interface{}
	if err := json.Unmarshal([]byte(result), &parsed); err != nil {
		t.Fatalf("Failed to parse JSON: %v", err)
	}
	if parsed["name"] != "test" {
		t.Errorf("Expected name to be 'test', got %v", parsed["name"])
	}
}

func TestSaveContext_CollectionFormat_Array(t *testing.T) {
	ctx := agentschema.NewSaveContext()
	ctx.CollectionFormat = "array"
	if ctx.CollectionFormat != "array" {
		t.Errorf("Expected CollectionFormat to be 'array', got %s", ctx.CollectionFormat)
	}
}

func TestSaveContext_UseShorthand_Disabled(t *testing.T) {
	ctx := agentschema.NewSaveContext()
	ctx.UseShorthand = false
	if ctx.UseShorthand != false {
		t.Error("Expected UseShorthand to be false")
	}
}

// Code generated by AgentSchema emitter; DO NOT EDIT.

package agentschema

import (
	"encoding/json"

	"gopkg.in/yaml.v3"
)

// AgentManifest represents The following represents a manifest that can be used to create agents dynamically.
// It includes parameters that can be used to configure the agent's behavior.
// These parameters include values that can be used as publisher parameters that can
// be used to describe additional variables that have been tested and are known to work.
//
// Variables described here are then used to project into a prompt agent that can be executed.
// Once parameters are provided, these can be referenced in the manifest using the following notation:
//
// `{{myParameter}}`
//
// This allows for dynamic configuration of the agent based on the provided parameters.
// (This notation is used elsewhere, but only the `param` scope is supported here)

type AgentManifest struct {
	Name        string                 `json:"name" yaml:"name"`
	DisplayName string                 `json:"displayName" yaml:"displayName"`
	Description *string                `json:"description,omitempty" yaml:"description,omitempty"`
	Metadata    map[string]interface{} `json:"metadata,omitempty" yaml:"metadata,omitempty"`
	Template    AgentDefinition        `json:"template" yaml:"template"`
	Parameters  PropertySchema         `json:"parameters" yaml:"parameters"`
	Resources   []Resource             `json:"resources" yaml:"resources"`
}

// LoadAgentManifest creates a AgentManifest from a map[string]interface{}
func LoadAgentManifest(data interface{}, ctx *LoadContext) (AgentManifest, error) {
	result := AgentManifest{}

	// Load from map
	if m, ok := data.(map[string]interface{}); ok {
		if val, ok := m["name"]; ok && val != nil {
			result.Name = val.(string)
		}
		if val, ok := m["displayName"]; ok && val != nil {
			result.DisplayName = val.(string)
		}
		if val, ok := m["description"]; ok && val != nil {
			v := val.(string)
			result.Description = &v
		}
		if val, ok := m["metadata"]; ok && val != nil {
			if m, ok := val.(map[string]interface{}); ok {
				result.Metadata = m
			}
		}
		if val, ok := m["template"]; ok && val != nil {
			if m, ok := val.(map[string]interface{}); ok {
				loaded, _ := LoadAgentDefinition(m, ctx)
				// Type assert from interface{} in case Load returns interface{} for polymorphic types
				result.Template = loaded.(AgentDefinition)
			}
		}
		if val, ok := m["parameters"]; ok && val != nil {
			if m, ok := val.(map[string]interface{}); ok {
				loaded, _ := LoadPropertySchema(m, ctx)
				result.Parameters = loaded
			}
		}
		if val, ok := m["resources"]; ok && val != nil {
			if arr, ok := val.([]interface{}); ok {
				result.Resources = make([]Resource, len(arr))
				for i, v := range arr {
					if item, ok := v.(map[string]interface{}); ok {
						loaded, _ := LoadResource(item, ctx)
						// Type assert from interface{} in case Load returns interface{} for polymorphic types
						result.Resources[i] = loaded.(Resource)
					}
				}
			}
		}
	}

	return result, nil
}

// Save serializes AgentManifest to map[string]interface{}
func (obj *AgentManifest) Save(ctx *SaveContext) map[string]interface{} {
	result := make(map[string]interface{})
	result["name"] = obj.Name
	result["displayName"] = obj.DisplayName
	if obj.Description != nil {
		result["description"] = *obj.Description
	}
	if obj.Metadata != nil {
		result["metadata"] = obj.Metadata
	}
	result["template"] = obj.Template.Save(ctx)
	result["parameters"] = obj.Parameters.Save(ctx)
	if obj.Resources != nil {
		arr := make([]interface{}, len(obj.Resources))
		for i, item := range obj.Resources {
			arr[i] = item.Save(ctx)
		}
		result["resources"] = arr
	}

	return result
}

// ToJSON serializes AgentManifest to JSON string
func (obj *AgentManifest) ToJSON() (string, error) {
	ctx := NewSaveContext()
	data := obj.Save(ctx)
	bytes, err := json.Marshal(data)
	if err != nil {
		return "", err
	}
	return string(bytes), nil
}

// ToYAML serializes AgentManifest to YAML string
func (obj *AgentManifest) ToYAML() (string, error) {
	ctx := NewSaveContext()
	data := obj.Save(ctx)
	bytes, err := yaml.Marshal(data)
	if err != nil {
		return "", err
	}
	return string(bytes), nil
}

// FromJSON creates AgentManifest from JSON string
func AgentManifestFromJSON(jsonStr string) (AgentManifest, error) {
	var data map[string]interface{}
	if err := json.Unmarshal([]byte(jsonStr), &data); err != nil {
		return AgentManifest{}, err
	}
	ctx := NewLoadContext()
	return LoadAgentManifest(data, ctx)
}

// FromYAML creates AgentManifest from YAML string
func AgentManifestFromYAML(yamlStr string) (AgentManifest, error) {
	var data map[string]interface{}
	if err := yaml.Unmarshal([]byte(yamlStr), &data); err != nil {
		return AgentManifest{}, err
	}
	ctx := NewLoadContext()
	return LoadAgentManifest(data, ctx)
}

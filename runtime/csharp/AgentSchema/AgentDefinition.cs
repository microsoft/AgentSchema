
// Copyright (c) Microsoft. All rights reserved.
// WARNING: This is an auto-generated file. DO NOT EDIT THIS FILE DIRECTLY.

using System.Text.Json;
using YamlDotNet.Serialization;

#pragma warning disable IDE0130
namespace AgentSchema;
#pragma warning restore IDE0130

/// <summary>
/// The following is a specification for defining AI agents with structured metadata, inputs, outputs, tools, and templates.
/// It provides a way to create reusable and composable AI agents that can be executed with specific configurations.
/// The specification includes metadata about the agent, model configuration, input parameters, expected outputs,
/// available tools, and template configurations for prompt rendering.
/// </summary>
public abstract class AgentDefinition
{
    /// <summary>
    /// The shorthand property name for this type, if any.
    /// </summary>
    public static string? ShorthandProperty => null;

    /// <summary>
    /// Initializes a new instance of <see cref="AgentDefinition"/>.
    /// </summary>
#pragma warning disable CS8618
    protected AgentDefinition()
    {
    }
#pragma warning restore CS8618

    /// <summary>
    /// Kind represented by the document
    /// </summary>
    public virtual string Kind { get; set; } = string.Empty;

    /// <summary>
    /// Human-readable name of the agent
    /// </summary>
    public string Name { get; set; } = string.Empty;

    /// <summary>
    /// Display name of the agent for UI purposes
    /// </summary>
    public string? DisplayName { get; set; }

    /// <summary>
    /// Description of the agent's capabilities and purpose
    /// </summary>
    public string? Description { get; set; }

    /// <summary>
    /// Additional metadata including authors, tags, and other arbitrary properties
    /// </summary>
    public IDictionary<string, object>? Metadata { get; set; }

    /// <summary>
    /// Input parameters that participate in template rendering
    /// </summary>
    public PropertySchema? InputSchema { get; set; }

    /// <summary>
    /// Expected output format and structure from the agent
    /// </summary>
    public PropertySchema? OutputSchema { get; set; }


    #region Load Methods

    /// <summary>
    /// Load a AgentDefinition instance from a dictionary.
    /// </summary>
    /// <param name="data">The dictionary containing the data.</param>
    /// <param name="context">Optional context with pre/post processing callbacks.</param>
    /// <returns>The loaded AgentDefinition instance.</returns>
    public static AgentDefinition Load(Dictionary<string, object?> data, LoadContext? context = null)
    {
        if (context is not null)
        {
            data = context.ProcessInput(data);
        }


        // Load polymorphic AgentDefinition instance
        var instance = LoadKind(data, context);


        if (data.TryGetValue("kind", out var kindValue) && kindValue is not null)
        {
            instance.Kind = kindValue?.ToString()!;
        }

        if (data.TryGetValue("name", out var nameValue) && nameValue is not null)
        {
            instance.Name = nameValue?.ToString()!;
        }

        if (data.TryGetValue("displayName", out var displayNameValue) && displayNameValue is not null)
        {
            instance.DisplayName = displayNameValue?.ToString()!;
        }

        if (data.TryGetValue("description", out var descriptionValue) && descriptionValue is not null)
        {
            instance.Description = descriptionValue?.ToString()!;
        }

        if (data.TryGetValue("metadata", out var metadataValue) && metadataValue is not null)
        {
            instance.Metadata = metadataValue.GetDictionary()!;
        }

        if (data.TryGetValue("inputSchema", out var inputSchemaValue) && inputSchemaValue is not null)
        {
            instance.InputSchema = PropertySchema.Load(inputSchemaValue.GetDictionary(), context);
        }

        if (data.TryGetValue("outputSchema", out var outputSchemaValue) && outputSchemaValue is not null)
        {
            instance.OutputSchema = PropertySchema.Load(outputSchemaValue.GetDictionary(), context);
        }

        if (context is not null)
        {
            instance = context.ProcessOutput(instance);
        }
        return instance;
    }



    /// <summary>
    /// Load polymorphic AgentDefinition based on discriminator.
    /// </summary>
    private static AgentDefinition LoadKind(Dictionary<string, object?> data, LoadContext? context)
    {
        if (data.TryGetValue("kind", out var discriminatorValue) && discriminatorValue is not null)
        {
            var discriminator = discriminatorValue.ToString()?.ToLowerInvariant();
            return discriminator switch
            {
                "prompt" => PromptAgent.Load(data, context),
                "workflow" => Workflow.Load(data, context),
                "hosted" => ContainerAgent.Load(data, context),
                _ => throw new ArgumentException($"Unknown AgentDefinition discriminator value: {discriminator}"),
            };
        }

        throw new ArgumentException("Missing AgentDefinition discriminator property: 'kind'");

    }


    #endregion

    #region Save Methods

    /// <summary>
    /// Save the AgentDefinition instance to a dictionary.
    /// </summary>
    /// <param name="context">Optional context with pre/post processing callbacks.</param>
    /// <returns>The dictionary representation of this instance.</returns>
    public virtual Dictionary<string, object?> Save(SaveContext? context = null)
    {
        var obj = this;
        if (context is not null)
        {
            obj = context.ProcessObject(obj);
        }


        var result = new Dictionary<string, object?>();


        if (obj.Kind is not null)
        {
            result["kind"] = obj.Kind;
        }

        if (obj.Name is not null)
        {
            result["name"] = obj.Name;
        }

        if (obj.DisplayName is not null)
        {
            result["displayName"] = obj.DisplayName;
        }

        if (obj.Description is not null)
        {
            result["description"] = obj.Description;
        }

        if (obj.Metadata is not null)
        {
            result["metadata"] = obj.Metadata;
        }

        if (obj.InputSchema is not null)
        {
            result["inputSchema"] = obj.InputSchema?.Save(context);
        }

        if (obj.OutputSchema is not null)
        {
            result["outputSchema"] = obj.OutputSchema?.Save(context);
        }


        if (context is not null)
        {
            result = context.ProcessDict(result);
        }

        return result;
    }


    /// <summary>
    /// Convert the AgentDefinition instance to a YAML string.
    /// </summary>
    /// <param name="context">Optional context with pre/post processing callbacks.</param>
    /// <returns>The YAML string representation of this instance.</returns>
    public string ToYaml(SaveContext? context = null)
    {
        context ??= new SaveContext();
        return context.ToYaml(Save(context));
    }

    /// <summary>
    /// Convert the AgentDefinition instance to a JSON string.
    /// </summary>
    /// <param name="context">Optional context with pre/post processing callbacks.</param>
    /// <param name="indent">Whether to indent the output. Defaults to true.</param>
    /// <returns>The JSON string representation of this instance.</returns>
    public string ToJson(SaveContext? context = null, bool indent = true)
    {
        context ??= new SaveContext();
        return context.ToJson(Save(context), indent);
    }

    /// <summary>
    /// Load a AgentDefinition instance from a JSON string.
    /// </summary>
    /// <param name="json">The JSON string to parse.</param>
    /// <param name="context">Optional context with pre/post processing callbacks.</param>
    /// <returns>The loaded AgentDefinition instance.</returns>
    public static AgentDefinition FromJson(string json, LoadContext? context = null)
    {
        using var doc = JsonDocument.Parse(json);
        Dictionary<string, object?> dict;
        dict = JsonSerializer.Deserialize<Dictionary<string, object?>>(json, JsonUtils.Options)
            ?? throw new ArgumentException("Failed to parse JSON as dictionary");

        return Load(dict, context);
    }

    /// <summary>
    /// Load a AgentDefinition instance from a YAML string.
    /// </summary>
    /// <param name="yaml">The YAML string to parse.</param>
    /// <param name="context">Optional context with pre/post processing callbacks.</param>
    /// <returns>The loaded AgentDefinition instance.</returns>
    public static AgentDefinition FromYaml(string yaml, LoadContext? context = null)
    {
        var dict = YamlUtils.Deserializer.Deserialize<Dictionary<string, object?>>(yaml)
            ?? throw new ArgumentException("Failed to parse YAML as dictionary");

        return Load(dict, context);
    }

    #endregion
}

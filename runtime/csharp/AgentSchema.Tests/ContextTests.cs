
// Copyright (c) Microsoft. All rights reserved.
// WARNING: This is an auto-generated file. DO NOT EDIT THIS FILE DIRECTLY.

using Xunit;

#pragma warning disable IDE0130
namespace AgentSchema;
#pragma warning restore IDE0130

public class LoadContextTests
{
    [Fact]
    public void DefaultValues_PreProcessIsNull()
    {
        var context = new LoadContext();
        Assert.Null(context.PreProcess);
    }

    [Fact]
    public void DefaultValues_PostProcessIsNull()
    {
        var context = new LoadContext();
        Assert.Null(context.PostProcess);
    }

    [Fact]
    public void ProcessInput_ReturnsOriginalWhenNoCallback()
    {
        var context = new LoadContext();
        var data = new Dictionary<string, object?> { { "key", "value" } };
        var result = context.ProcessInput(data);
        Assert.Same(data, result);
    }

    [Fact]
    public void ProcessInput_AppliesPreProcessCallback()
    {
        var context = new LoadContext
        {
            PreProcess = data => new Dictionary<string, object?>(data) { { "added", true } }
        };
        var data = new Dictionary<string, object?> { { "key", "value" } };
        var result = context.ProcessInput(data);
        Assert.True(result.ContainsKey("added"));
        Assert.Equal(true, result["added"]);
    }

    [Fact]
    public void ProcessOutput_ReturnsOriginalWhenNoCallback()
    {
        var context = new LoadContext();
        var result = new Dictionary<string, object?> { { "some", "result" } };
        var processed = context.ProcessOutput(result);
        Assert.Same(result, processed);
    }

    [Fact]
    public void ProcessOutput_AppliesPostProcessCallback()
    {
        var context = new LoadContext
        {
            PostProcess = obj => new Dictionary<string, object?> { { "wrapped", obj } }
        };
        var result = new Dictionary<string, object?> { { "key", "value" } };
        var processed = context.ProcessOutput(result);
        Assert.True(processed.ContainsKey("wrapped"));
    }
}

public class SaveContextTests
{
    [Fact]
    public void DefaultValues_PreSaveIsNull()
    {
        var context = new SaveContext();
        Assert.Null(context.PreSave);
    }

    [Fact]
    public void DefaultValues_PostSaveIsNull()
    {
        var context = new SaveContext();
        Assert.Null(context.PostSave);
    }

    [Fact]
    public void DefaultValues_CollectionFormatIsObject()
    {
        var context = new SaveContext();
        Assert.Equal("object", context.CollectionFormat);
    }

    [Fact]
    public void DefaultValues_UseShorthandIsTrue()
    {
        var context = new SaveContext();
        Assert.True(context.UseShorthand);
    }

    [Fact]
    public void ProcessObject_ReturnsOriginalWhenNoCallback()
    {
        var context = new SaveContext();
        var obj = new Dictionary<string, object?> { { "key", "value" } };
        var result = context.ProcessObject(obj);
        Assert.Same(obj, result);
    }

    [Fact]
    public void ProcessObject_AppliesPreSaveCallback()
    {
        var context = new SaveContext
        {
            PreSave = obj =>
            {
                var dict = new Dictionary<string, object?>((Dictionary<string, object?>)obj)
                {
                    { "timestamp", "2024-01-01" }
                };
                return dict;
            }
        };
        var obj = new Dictionary<string, object?> { { "key", "value" } };
        var result = context.ProcessObject(obj);
        Assert.True(((Dictionary<string, object?>)result).ContainsKey("timestamp"));
    }

    [Fact]
    public void ProcessDict_ReturnsOriginalWhenNoCallback()
    {
        var context = new SaveContext();
        var data = new Dictionary<string, object?> { { "key", "value" } };
        var result = context.ProcessDict(data);
        Assert.Same(data, result);
    }

    [Fact]
    public void ProcessDict_AppliesPostSaveCallback()
    {
        var context = new SaveContext
        {
            PostSave = data =>
            {
                var result = new Dictionary<string, object?>();
                foreach (var kvp in data)
                {
                    if (!kvp.Key.StartsWith("_"))
                    {
                        result[kvp.Key] = kvp.Value;
                    }
                }
                return result;
            }
        };
        var data = new Dictionary<string, object?> { { "key", "value" }, { "_internal", "secret" } };
        var result = context.ProcessDict(data);
        Assert.False(result.ContainsKey("_internal"));
        Assert.True(result.ContainsKey("key"));
    }

    [Fact]
    public void ToYaml_ProducesValidYaml()
    {
        var context = new SaveContext();
        var data = new Dictionary<string, object?> { { "name", "test" } };
        var result = context.ToYaml(data);
        Assert.Contains("name: test", result);
    }

    [Fact]
    public void ToJson_ProducesValidJson()
    {
        var context = new SaveContext();
        var data = new Dictionary<string, object?> { { "name", "test" } };
        var result = context.ToJson(data);
        Assert.Contains("name", result);
        Assert.Contains("test", result);
    }

    [Fact]
    public void CollectionFormat_CanBeSetToArray()
    {
        var context = new SaveContext { CollectionFormat = "array" };
        Assert.Equal("array", context.CollectionFormat);
    }

    [Fact]
    public void UseShorthand_CanBeDisabled()
    {
        var context = new SaveContext { UseShorthand = false };
        Assert.False(context.UseShorthand);
    }
}

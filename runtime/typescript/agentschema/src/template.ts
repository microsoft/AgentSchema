// Copyright (c) Microsoft. All rights reserved.
// WARNING: This is an auto-generated file. DO NOT EDIT THIS FILE DIRECTLY.

import { LoadContext, SaveContext } from "./context";
import { Format } from "./format";
import { Parser } from "./parser";

/**
 * Template model for defining prompt templates.
 *
 * This model specifies the rendering engine used for slot filling prompts,
 * the parser used to process the rendered template into API-compatible format,
 * and additional options for the template engine.
 *
 * It allows for the creation of reusable templates that can be filled with dynamic data
 * and processed to generate prompts for AI models.
 *
 */
export class Template {
  /**
   * The shorthand property name for this type, if any.
   */
  static readonly shorthandProperty: string | undefined = undefined;

  /**
   * Template rendering engine used for slot filling prompts (e.g., mustache, jinja2)
   */
  format: Format;

  /**
   * Parser used to process the rendered template into API-compatible format
   */
  parser: Parser;

  /**
   * Initializes a new instance of Template.
   */
  constructor(init?: Partial<Template>) {
    this.format = init?.format ?? undefined!;

    this.parser = init?.parser ?? undefined!;
  }

  //#region Load Methods

  /**
   * Load a Template instance from a dictionary.
   * @param data - The dictionary containing the data.
   * @param context - Optional context with pre/post processing callbacks.
   * @returns The loaded Template instance.
   */
  static load(data: Record<string, unknown>, context?: LoadContext): Template {
    if (context) {
      data = context.processInput(data);
    }

    // Create new instance
    const instance = new Template();

    if (data["format"] !== undefined && data["format"] !== null) {
      instance.format = Format.load(data["format"] as Record<string, unknown>, context);
    }

    if (data["parser"] !== undefined && data["parser"] !== null) {
      instance.parser = Parser.load(data["parser"] as Record<string, unknown>, context);
    }

    if (context) {
      return context.processOutput(instance) as Template;
    }
    return instance;
  }

  //#endregion

  //#region Save Methods

  /**
   * Save the Template instance to a dictionary.
   * @param context - Optional context with pre/post processing callbacks.
   * @returns The dictionary representation of this instance.
   */
  save(context?: SaveContext): Record<string, unknown> {
    const obj = context ? (context.processObject(this) as Template) : this;

    const result: Record<string, unknown> = {};

    if (obj.format !== undefined && obj.format !== null) {
      result["format"] = obj.format?.save(context);
    }

    if (obj.parser !== undefined && obj.parser !== null) {
      result["parser"] = obj.parser?.save(context);
    }

    if (context) {
      return context.processDict(result);
    }

    return result;
  }

  /**
   * Convert the Template instance to a YAML string.
   * @param context - Optional context with pre/post processing callbacks.
   * @returns The YAML string representation of this instance.
   */
  toYaml(context?: SaveContext): string {
    context = context ?? new SaveContext();
    return context.toYaml(this.save(context));
  }

  /**
   * Convert the Template instance to a JSON string.
   * @param context - Optional context with pre/post processing callbacks.
   * @param indent - Number of spaces for indentation. Defaults to 2.
   * @returns The JSON string representation of this instance.
   */
  toJson(context?: SaveContext, indent: number = 2): string {
    context = context ?? new SaveContext();
    return context.toJson(this.save(context), indent);
  }

  /**
   * Load a Template instance from a JSON string.
   * @param json - The JSON string to parse.
   * @param context - Optional context with pre/post processing callbacks.
   * @returns The loaded Template instance.
   */
  static fromJson(json: string, context?: LoadContext): Template {
    const data = JSON.parse(json);

    return Template.load(data as Record<string, unknown>, context);
  }

  /**
   * Load a Template instance from a YAML string.
   * @param yaml - The YAML string to parse.
   * @param context - Optional context with pre/post processing callbacks.
   * @returns The loaded Template instance.
   */
  static fromYaml(yaml: string, context?: LoadContext): Template {
    const { parse } = require("yaml");
    const data = parse(yaml);

    return Template.load(data as Record<string, unknown>, context);
  }

  //#endregion
}

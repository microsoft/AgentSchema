// Code generated by AgentSchema emitter; DO NOT EDIT.

#[allow(unused_imports)]
use crate::*;

#[doc(hidden)]
#[derive(serde::Deserialize)]
struct _ParserFields {
    #[serde(rename = "kind", default)]
    kind: String,
    #[serde(rename = "options", default)]
    options: serde_json::Value,
}

#[doc(hidden)]
#[derive(serde::Deserialize)]
#[serde(untagged)]
enum _ParserRepr {
    Short(String),
    Full(_ParserFields),
}

/// Parser represents Template parser definition

#[derive(Debug, Clone, Default, serde::Serialize)]
pub struct Parser {
    #[serde(rename = "kind", default)]
    pub kind: String,
    #[serde(rename = "options", default)]
    pub options: serde_json::Value,
}

impl<'de> serde::Deserialize<'de> for Parser {
    fn deserialize<D: serde::Deserializer<'de>>(d: D) -> Result<Self, D::Error> {
        let repr = _ParserRepr::deserialize(d)?;
        match repr {
            _ParserRepr::Short(v) => {
                let expanded = serde_json::json!({
                    "kind": v
                });
                let fields: _ParserFields = serde_json::from_value(expanded)
                    .map_err(|e| serde::de::Error::custom(e.to_string()))?;
                Ok(Parser {
                    kind: fields.kind,
                    options: fields.options,
                })
            }
            _ParserRepr::Full(f) => Ok(Parser {
                kind: f.kind,
                options: f.options,
            }),
        }
    }
}

impl Parser {
    /// Load from a JSON string.
    pub fn from_json(s: &str) -> Result<Self, String> {
        serde_json::from_str(s).map_err(|e| e.to_string())
    }

    /// Serialize to a JSON string.
    pub fn to_json(&self) -> Result<String, String> {
        serde_json::to_string(self).map_err(|e| e.to_string())
    }

    /// Load from a YAML string.
    pub fn from_yaml(s: &str) -> Result<Self, String> {
        serde_yaml::from_str(s).map_err(|e| e.to_string())
    }

    /// Serialize to a YAML string.
    pub fn to_yaml(&self) -> Result<String, String> {
        serde_yaml::to_string(self).map_err(|e| e.to_string())
    }
}

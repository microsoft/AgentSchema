// Code generated by AgentSchema emitter; DO NOT EDIT.

use crate::property::Property;

/// Definition for the property schema of a model.
/// This includes the properties and example records.
#[derive(Debug, Clone)]
pub struct PropertySchema {
    /// Example records for the input schema
    pub examples: serde_json::Value,
    /// Whether the input schema is strict - if true, only the defined properties are allowed
    pub strict: Option<bool>,
    /// The input properties for the schema
    pub properties: serde_json::Value,
}

impl Default for PropertySchema {
    fn default() -> Self {
        PropertySchema {
            examples: serde_json::Value::Null,
            strict: None,
            properties: serde_json::Value::Null,
        }
    }
}

impl PropertySchema {
    /// Create a new PropertySchema with default values.
    pub fn new() -> Self {
        Self::default()
    }

    /// Load PropertySchema from a JSON string.
    pub fn from_json(json: &str) -> Result<Self, serde_json::Error> {
        let value: serde_json::Value = serde_json::from_str(json)?;
        Ok(Self::load_from_value(&value))
    }

    /// Load PropertySchema from a YAML string.
    pub fn from_yaml(yaml: &str) -> Result<Self, serde_yaml::Error> {
        let value: serde_json::Value = serde_yaml::from_str(yaml)?;
        Ok(Self::load_from_value(&value))
    }

    /// Load PropertySchema from a `serde_json::Value`.
    pub fn load_from_value(value: &serde_json::Value) -> Self {
        let mut result = Self::default();
        // Load fields from JSON object
        if let Some(val) = value.get("examples") {
            result.examples = val.clone();
        }
        result.strict = value.get("strict").and_then(|v| v.as_bool());
        if let Some(val) = value.get("properties") {
            result.properties = val.clone();
        }
        result
    }

    /// Serialize PropertySchema to a `serde_json::Value`.
    pub fn to_value(&self) -> serde_json::Value {
        let mut result = serde_json::Map::new();
        if !self.examples.is_null() {
            result.insert("examples".to_string(), self.examples.clone());
        }
        if let Some(val) = self.strict {
            result.insert("strict".to_string(), serde_json::Value::Bool(val));
        }
        if !self.properties.is_null() {
            result.insert("properties".to_string(), self.properties.clone());
        }
        serde_json::Value::Object(result)
    }

    /// Serialize PropertySchema to a JSON string.
    pub fn to_json(&self) -> Result<String, serde_json::Error> {
        serde_json::to_string_pretty(&self.to_value())
    }

    /// Serialize PropertySchema to a YAML string.
    pub fn to_yaml(&self) -> Result<String, serde_yaml::Error> {
        serde_yaml::to_string(&self.to_value())
    }
    /// Returns typed reference to the map if the field is an object.
    /// Returns `None` if the field is null or not an object.
    pub fn as_examples_dict(&self) -> Option<&serde_json::Map<String, serde_json::Value>> {
        self.examples.as_object()
    }
    /// Returns typed `Vec<Property>` by parsing the stored JSON value.
    /// Handles both array format `[{...}]` and dict format `{"name": {...}}`.
    /// Returns `None` if the field is null or cannot be parsed.
    pub fn as_properties(&self) -> Option<Vec<Property>> {
        match &self.properties {
            serde_json::Value::Array(arr) => {
                Some(arr.iter().map(Property::load_from_value).collect())
            }
            serde_json::Value::Object(obj) => {
                let result: Vec<Property> = obj
                    .iter()
                    .map(|(name, value)| {
                        let mut v = if value.is_object() {
                            value.clone()
                        } else {
                            serde_json::json!({ "value": value })
                        };
                        if let serde_json::Value::Object(ref mut m) = v {
                            m.entry("name".to_string())
                                .or_insert_with(|| serde_json::Value::String(name.clone()));
                        }
                        Property::load_from_value(&v)
                    })
                    .collect();
                Some(result)
            }
            _ => None,
        }
    }
}

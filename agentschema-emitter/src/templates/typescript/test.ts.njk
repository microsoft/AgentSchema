{#
  TypeScript Test Template
  ========================
  Renders test files for TypeScript classes.
  
  Expected context (TypeScriptTestContext):
    - node: TypeNode
    - examples: Array<{ json: string[], yaml: string[], validation: Array<...> }>
    - alternates: Array<{ title: string, scalar: string, value: string, validation: Array<...> }>
    - renderName: function
    - namespace: string
    - isAbstract: boolean
#}
// Copyright (c) Microsoft. All rights reserved.
// WARNING: This is an auto-generated file. DO NOT EDIT THIS FILE DIRECTLY.

import { {{ node.typeName.name }} } from "../src/index";

describe("{{ node.typeName.name }}", () => {
  {% if examples.length > 0 %}

  describe("JSON serialization", () => {
    {% for example in examples %}
    it("should load from JSON - example {{ loop.index }}", () => {
      const json = `{{ example.json | join("\\n") | safe }}`;
      const instance = {{ node.typeName.name }}.fromJson(json);
      expect(instance).toBeDefined();
      {% for val in example.validation %}
      expect(instance.{{ val.key }}).toEqual({{ val.delimeter }}{{ val.value }}{{ val.delimeter }});
      {% endfor %}
    });

    it("should round-trip JSON - example {{ loop.index }}", () => {
      const json = `{{ example.json | join("\\n") | safe }}`;
      const instance = {{ node.typeName.name }}.fromJson(json);
      const output = instance.toJson();
      const reloaded = {{ node.typeName.name }}.fromJson(output);
      {% for val in example.validation %}
      expect(reloaded.{{ val.key }}).toEqual(instance.{{ val.key }});
      {% endfor %}
    });

    it("should serialize to valid JSON - example {{ loop.index }}", () => {
      const json = `{{ example.json | join("\\n") | safe }}`;
      const instance = {{ node.typeName.name }}.fromJson(json);
      const output = instance.toJson();
      expect(output).toBeDefined();
      const parsed = JSON.parse(output);
      expect(typeof parsed).toBe("object");
    });
    {% endfor %}
  });

  describe("YAML serialization", () => {
    {% for example in examples %}
    it("should load from YAML - example {{ loop.index }}", () => {
      const yaml = `{{ example.yaml | join("\\n") | safe }}`;
      const instance = {{ node.typeName.name }}.fromYaml(yaml);
      expect(instance).toBeDefined();
      {% for val in example.validation %}
      expect(instance.{{ val.key }}).toEqual({{ val.delimeter }}{{ val.value }}{{ val.delimeter }});
      {% endfor %}
    });

    it("should round-trip YAML - example {{ loop.index }}", () => {
      const yaml = `{{ example.yaml | join("\\n") | safe }}`;
      const instance = {{ node.typeName.name }}.fromYaml(yaml);
      const output = instance.toYaml();
      const reloaded = {{ node.typeName.name }}.fromYaml(output);
      {% for val in example.validation %}
      expect(reloaded.{{ val.key }}).toEqual(instance.{{ val.key }});
      {% endfor %}
    });

    it("should serialize to valid YAML - example {{ loop.index }}", () => {
      const yaml = `{{ example.yaml | join("\\n") | safe }}`;
      const instance = {{ node.typeName.name }}.fromYaml(yaml);
      const output = instance.toYaml();
      expect(output).toBeDefined();
      // YAML output should be parseable back
      const reloaded = {{ node.typeName.name }}.fromYaml(output);
      expect(reloaded).toBeDefined();
    });
    {% endfor %}
  });
  {% endif %}
  {% if alternates.length > 0 %}

  describe("alternate representations", () => {
    {% for alt in alternates %}
    it("should handle {{ alt.title }} alternate representation from JSON", () => {
      const value = {{ alt.value }};
      const json = JSON.stringify(value);
      const instance = {{ node.typeName.name }}.fromJson(json);
      expect(instance).toBeDefined();
      {% for val in alt.validation %}
      expect(instance.{{ renderName(val.key) | lower | replace(".", "") }}).toEqual({{ val.delimeter }}{{ val.value }}{{ val.delimeter }});
      {% endfor %}
    });

    it("should handle {{ alt.title }} alternate representation from YAML", () => {
      const value = {{ alt.value }};
      const yaml = typeof value === "string" ? `"${value}"` : String(value);
      const instance = {{ node.typeName.name }}.fromYaml(yaml);
      expect(instance).toBeDefined();
      {% for val in alt.validation %}
      expect(instance.{{ renderName(val.key) | lower | replace(".", "") }}).toEqual({{ val.delimeter }}{{ val.value }}{{ val.delimeter }});
      {% endfor %}
    });
    {% endfor %}
  });
  {% endif %}

  {% if not (isAbstract and node.isAbstract) %}
  describe("load and save", () => {
    {% if not isAbstract %}
    it("should load from dictionary", () => {
      const data: Record<string, unknown> = {};
      const instance = {{ node.typeName.name }}.load(data);
      expect(instance).toBeDefined();
    });
    {% endif %}

    {% if not node.isAbstract %}
    it("should save to dictionary", () => {
      const instance = new {{ node.typeName.name }}();
      const data = instance.save();
      expect(data).toBeDefined();
      expect(typeof data).toBe("object");
    });
    {% endif %}
  });
  {% endif %}
});

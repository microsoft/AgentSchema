---
title: Adding a New Language
description: Guide for adding a new runtime language to AgentSchema
sidebar:
  order: 6
---

import { Steps, FileTree } from '@astrojs/starlight/components';

This guide documents the process for adding a new language runtime to AgentSchema. All runtimes must implement identical functionality and test coverage.

## Requirements

Before adding a new language, ensure you understand:

1. **Test standards** - All languages must have the same test categories
2. **Template conventions** - Naming, headers, and structure
3. **Code generation** - How the emitter transforms TypeSpec to code

## Architecture Overview

<FileTree>
- agentschema-emitter/
  - src/
    - **\{language\}.ts** language-specific generator
    - templates/
      - **\{language\}/** template directory
        - file.\{ext\}.njk
        - test.\{ext\}.njk
        - context.\{ext\}.njk
        - test_context.\{ext\}.njk
        - _macros.njk
- runtime/
  - **\{language\}/** generated output
</FileTree>

## Step-by-Step Process

<Steps>

1. **Create the emitter file**

   Create `agentschema-emitter/src/\{language\}.ts` with:
   
   - Type mapper for scalar types
   - `emit\{Language\}()` main function
   - `buildFileContext()` for class templates
   - `buildTestContext()` for test templates

2. **Create template directory**

   Create `agentschema-emitter/src/templates/\{language\}/` with:
   
   - `file.\{ext\}.njk` - Main class/struct definitions
   - `test.\{ext\}.njk` - Test file template
   - `context.\{ext\}.njk` - LoadContext/SaveContext
   - `test_context.\{ext\}.njk` - Context tests
   - `_macros.njk` - Shared template macros (optional)

3. **Register in emitter.ts**

   Add your language to the emitter dispatch:
   
   ```typescript
   import { emitLanguage } from "./language.js";
   
   // In emit function:
   if (emitTarget.language === "language") {
     await emitLanguage(context, emitTarget);
   }
   ```

4. **Add to tspconfig.yaml**

   ```yaml
   targets:
     - language: "language"
       output-dir: "../runtime/language/package/src"
       test-dir: "../runtime/language/package/tests"
   ```

5. **Create runtime directory**

   Set up the package structure in `runtime/\{language\}/`:
   
   - Package manifest (package.json, go.mod, pyproject.toml, etc.)
   - Test configuration
   - README.md

6. **Update documentation**

   - Add to runtime docs in `docs/src/content/docs/runtimes/`
   - Update this contributing guide
   - Add to the front page runtime list

</Steps>

## Test Context Interface

Your `buildTestContext()` must provide:

```typescript
interface TestContext {
  node: TypeNode;
  examples: Array<{
    json: string[];      // JSON lines
    yaml: string[];      // YAML lines
    validation: Array<{
      key: string;       // Property name
      value: any;        // Expected value
      delimeter: string; // Quote for strings
    }>;
  }>;
  alternates: Array<{
    title: string;       // Test name
    scalar: string;      // Scalar type
    value: string;       // Quoted value
    rawValue: string;    // Unquoted value (for YAML)
    validation: Array<{ key, value, delimeter }>;
  }>;
  isAbstract: boolean;   // Skip instantiation tests
}
```

## Required Test Categories

Your test template **must** include all 10 categories:

1. JSON load tests
2. YAML load tests
3. JSON round-trip tests
4. YAML round-trip tests
5. JSON serialization output tests
6. YAML serialization output tests
7. JSON shorthand tests (where applicable)
8. YAML shorthand tests (where applicable)
9. Dictionary/map load tests
10. Dictionary/map save tests

See the [Testing Guide](/contributing/testing/) for details.

## Template Standards

### File Naming

```
file.{ext}.njk          # file.rs.njk, file.swift.njk
test.{ext}.njk          # test.rs.njk, test.swift.njk
context.{ext}.njk       # context.rs.njk, context.swift.njk
test_context.{ext}.njk  # test_context.rs.njk, test_context.swift.njk
```

### Template Header

```twig
{#
  {Language} File Template
  ========================
  Renders {language} file containing class definitions.
  
  Expected context ({Language}FileContext):
    - node: TypeNode
    - packageName: string
    - imports: string[]
#}
```

### Generated File Header

```
// Copyright (c) Microsoft. All rights reserved.
// WARNING: This is an auto-generated file. DO NOT EDIT THIS FILE DIRECTLY.
```

## Checklist

Before submitting a PR for a new language:

- [ ] Emitter file created and registered
- [ ] All 4 template files created (file, test, context, test_context)
- [ ] Templates have header comments
- [ ] Generated files have copyright/warning header
- [ ] All 10 test categories implemented
- [ ] Context tests implemented
- [ ] Test file naming follows convention
- [ ] Runtime package structure created
- [ ] Documentation updated
- [ ] All tests pass
- [ ] Test count is ~350 (similar to other runtimes)

## Reference Implementations

Use these as examples:

| Aspect | Best Reference |
|--------|----------------|
| Emitter structure | `typescript.ts` |
| Test context | `typescript.ts` â†’ `buildTestContext()` |
| Test template | `templates/typescript/test.ts.njk` |
| Polymorphic handling | `templates/go/test.go.njk` |
| Abstract type conditionals | All test templates |
